#prog_lang #prog_lang/cpp 

Perfect forwarding в C++ - это техника передачи аргументов функции дальше без потери типов и свойств этих аргументов. Она использует шаблонные типы и универсальные ссылки для сохранения оригинальных типов аргументов.

Основная идея заключается в следующем:

1. Объявить шаблонную функцию, которая принимает универсальные ссылки на аргументы:

```c++
template <typename T>
void forward(T&& arg) {
  // передача arg дальше 
}
```

2. Вызвать эту функцию, передавая аргументы:

```c++
forward(x);
```

3. Тип T будет выведен из типа x, сохраняя ссылочность и константность.
4. Функция forward просто передаст arg дальше, не меняя его тип.

Таким образом достигается передача аргумента дальше без потери свойств - это и есть perfect forwarding. Это полезно при реализации оберток или контейнеров.

Perfect forwarding в C++ нужен для следующих целей:

1. Сохранение семантики вызова функции. Без perfect forwarding ссылки и константность аргументов могут теряться при передаче в другие функции.
2. Предотвращение ненужных копирований. При передаче аргументов по значению происходит создание ненужных копий, которые с perfect forwarding можно избежать.
3. Оптимизация производительности. Благодаря сохранению ссылочности и возможности инлайнинга perfect forwarding позволяет оптимизировать вызовы функций.
4. Обобщенное программирование. Функции с perfect forwarding можно использовать с разными типами аргументов, экономя время на написание специализированных перегрузок.
5. Упрощение интерфейсов. Нет необходимости предоставлять перегруженные версии функций для ссылок, константных ссылок, указателей и т.д.
6. Избежание копирования при возврате значений из функций. Return value optimization работает лучше с perfect forwarding.