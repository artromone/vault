#prog #prog/db 

> ACID принципы описывают требования к транзакциям БД

1) [[Атомарность (Atomicity)]] – транзакция выполняется целиком или не выполняется вообще
2) [[Согласованность (Consistency)]] –  транзакция переводит БД из одного валидного состояния в другое, соблюдая правила (ограничения, индексы, триггеры)
3) [[Изоляция (Isolation)]] – параллельные транзакции не влияют друг на друга, уровни изоляции регулируют компромисс между производительностью и надежностью
4) [[Долговечность (Durability)]] – после подтверждения (`Commit`) данные сохраняются даже при сбоях (например, отключении сервера)

Всегда
- Явно управляйте транзакциями через `Begin()`, `Commit()`, `Rollback()`
- Выбирайте уровень изоляции под задачу
- Тестируйте сценарии откатов и параллельного доступа

Практические рекомендации для Golang
1) **Используйте ORM с осторожностью.** Библиотеки вроде GORM упрощают работу, но могут скрывать детали транзакций. Всегда проверяйте сгенерированные SQL-запросы.
2) **Тестируйте транзакции.** Используйте тестовые контейнеры (testcontainers) или встроенные SQLite в тестах:
```go
func TestTransfer(t *testing.T) {
    db, cleanup := setupTestDB() // Инициализация тестовой БД
    defer cleanup()

    // Тест на атомарность: проверка отката при ошибке
    err := transferMoney(db, 1, 2, 1000) // Сумма больше баланса
    assert.ErrorContains(t, err, "insufficient funds")
    // Проверка, что балансы не изменились
}
```
3) **Избегайте долгих транзакций.** Они блокируют ресурсы и увеличивают риск deadlock. Разбивайте операции на мелкие транзакции, если это возможно.