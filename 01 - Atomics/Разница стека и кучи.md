#prog/golang #prog #prog/computer_architecture #MEMORY

| Параметр           | Стек                             | Куча                          |
| ------------------ | -------------------------------- | ----------------------------- |
| Скорость           | Быстро (O(1))                    | Медленно (зависит от GC)      |
| Управление памятью | Автоматическое (LIFO)            | GC                            |
| Размер             | Ограничен, но динамически растёт | Большой (доступная память ОС) |
| Использование      | Локальные переменные             | Убегающие данные              |

Компилятор Go решает сам, где разместить перменную:
- Если она используется вне функции – попадает в [[Куча памяти]]
- Иначе остается в [[Стек памяти]]

Проверка:
```bash
go build -gcflags="-m" main.go
```
```
./main.go:10:6: moved to heap: user
```

**Когда переменные убегают в кучу**
- [[Возврат указателя на локальную переменную]]
- [[Сохранение указателя в глобальную переменную]]
- [[Передача в канал или интерфейс]]
- [[Очень большие объекты]]

**Минимизируйте аллокации в куче**:
   - Избегайте ненужных указателей
   - Используйте передачу по значению для небольших структур
   - Переиспользуйте объекты (sync.Pool)
**Советы**:
   - Если структура > 10 КБ, компилятор может поместить её в кучу
   - Срезы могут аллоцироваться в куче, если размер неизвестен на этапе компиляции
